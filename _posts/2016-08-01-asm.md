---
layout: post
title: 菜鸡学汇编系列（沉迷汇编无法自拔
subtitle: 作者：沉迷咸鱼的SpadeS
author: Coink 
date: 2016-08-01 00:00:00 
categories: 
tag: 
- Science
---

# 教练，我想学汇编

文章来自咸鱼[SpadeS](http://spades.click/)

（更新：别看了别看了 后面图床炸了orz

# 为什么要写这个系列

* 虽然是最底层的语言但是需要加深理解啊~~翻译：没好好学吧上课的时候~~

* 学习汇编可以深入了解CPU的工作原理

* 汇编通常可以用很短的代码做到很多奇妙的事情

* ~~好吧只是挂科带头复习顺便写下来点笔记记录QAQQQ~~

# 用什么软件好呢？

* 如果想图个方便，什么系统都用得了，你可以选择轻松汇编这个软件，它是武汉大学一名计算机系学生开发的，功能比较强大，错误信息也比较容易显示出来，是一个超强的IDE

* 想要高度还原DOS操作系统的话，就要用到DOSBox了，当然也不止是靠它进行，如果你需要完整的还原从编写，调试到汇编这些所有步骤的话，你需要三个在XP之前版本才有的系统exe，分别是debug.exe，link.exe，masm.exe。拥有了这些后，你需要调整你的DOSBox，下面就是具体的调试步骤了

# DOSBox如何进行汇编环境的配置呢？

1.先给你的电脑设定好一个文件夹，这个文件夹将会作为DOSBox的虚拟DOS系统挂载的C盘，然后将上述的3个exe放入这个文件夹。【下图中我的示例是在C盘下新建了一个名为DOSVirtual的文件夹，这里大家自定义啦~不过要记好路径
![](http://i2.piimg.com/567571/168aefecb5f0ca82.jpg)

2.在DOSBox将你创建的文件夹假设为虚拟DOS系统的C盘，指令是mount c 你设定的文件夹路径

3.进入虚拟系统的C盘
![](http://i2.piimg.com/567571/1c8f6ebd9a080b23.jpg)

上述就是关于汇编环境的配置了，接下来关于如何使用它们和更多关于汇编的内容明天说

zzzZZZ

 

# 8086的结构和组成

* 【这篇文章只需要你知道8086有这些寄存器就好了，作用日后会讲

# 关于8086处理器

8086处理器是Intel公司的第一个16位处理器，可以说具有划时代的意义

> 位：数据总线的根数，16位即代表它可以表示的无符号数最大是2的16次方减一（范围是0-65535）

x86汇编中，绝大部分指令与寄存器有关，因此我们需要了解一下x86的寄存器组构成

## 1. 数据寄存器

数据寄存器，看名字就很好理解了，存放着各种指令的目的数和源操作数，以及运算出来的结果【毕竟都是直观上能发现的数据

数据寄存器有4个，每个都是16位，与其他寄存器不同， **它独有的特性是，每个寄存器可以被分成两个独立的8位寄存器，高8位（15位-8位）构成高位寄存器（High），低8位（7-0）构成低位存储器** ，四个寄存器分别是AX，BX，CX，DX

>>AX(Accumulator)：累加器，用到的时候最多，用于大部分算术运算和逻辑运算，可分为AH（高8位）和AL（低8位）

>>BX(Base)：基址寄存器，多用于存放存储器地址，可分为BH（高8位）和BL（低8位）

>>CX(Count)：计数存储器，用到循环程序结构的时候，CX会被用做计数器，可分为CH（高8位）和CL（低8位）

>>DX(Data)：数据存储器，一般作为32位运算的高16位，或者存放外设端口，可分为DH（高8位）和DL（低8位）

## 2. 变址寄存器

变址寄存器&指针寄存器被用来寻址时提供存储器地址【预告一下下一篇讲寻址

变址寄存器有两个，SI和DI，SI（Source Index）是原地址寄存器，DI（Destnation Index）是目的地址寄存器，两个寄存器常常与数据段（Data Segment）和附加段（Extra Segment）联用，用于在这两个段进行寻址，这两个寄存器可以自动增量/自动减量

指针寄存器SP和BP主要是与堆栈有关（Stack），堆栈是主存中一个特殊的区域，学过数据结构的朋友应该都不陌生栈的性质，它是一个先进后出的结构，SP（Stack Pointer,堆栈指针寄存器）指向栈顶的偏移地址，BP（Base Pointer，基址指针寄存器）指向堆栈段的基地址，SP和BP是为了和SS（Stack Segment堆栈段）联用，来确定堆栈段中的存储地址。

## 3. 标志寄存器

标志称为flag~~想起立flag这个词的应该都不陌生了吧~~，这个寄存器中，每一位代表一个flag，每个flag只有1和0的状态，代表着运算时的不同状态，每一位对应的标志值如下

| 位数   | 15   | 14   | 13   | 12   | 11   | 10   | 9    | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
|      |      |      |      |      | OF   | DF   | IF   | TF   | SF   | ZF   |      | AF   |      | PF   |      | CF   |

各个flag的意义如下

![asm1.1](http://i1.piimg.com/4851/48ac9fbb333cfd7d.jpg)

各个flag在debug里这样表示状态

![asm1.2](http://i1.piimg.com/4851/3219b657b8a2baef.jpg)

![asm1.3](http://i1.piimg.com/4851/acd48de251c1f195.jpg)

各个标志的作用，之后讲到各个内容的时候会更深♂入的写一下

## 4. 指令指针寄存器

汇编程序是由很多条指令构成的，因此需要有一个标志指示代码从哪一条指令开始，指令指针寄存器（又称为IP，Instruction Pointer）就是做这个工作的，它指出将要执行的指令在主存中的位置，它具有自动增量的功能，这样处理器执行完一条指令后，只通过IP寄存器又可以直接执行下一条指令。

## 5. 段寄存器

汇编程序设计中，程序中有各种类型的数据，或者要执行的代码，按这些分类，相关的代码会归纳在一个区域，相关的数据也会归纳在一个区域，这些区域称为 **段（Segment）** ，应用程序主要用到4类段：存放代码的 **代码段CS（Code Segment）** ，存放数据的 **数据段DS（Data Segment）** ，用到堆栈区域的 **堆栈段SS（Stack Segment）** ，以及一个为了处理串操作指令而存放数据的 **附加段ES（Extra Segment）** 

因此就有了段寄存器，指明这些段在主存中的位置，方便寻址，名字简称就是各个段的英文名字简称。

/***********************************分割线********************************/

经过上面的介绍之后，可以得出这个8086的寄存器的组成结构

![asm1.4](http://i1.piimg.com/4851/915c35ca168238a4.jpg)

这一部分讲完之后，后面可以开始告诉你们最基本的寻址，寄存器内的操作指令啦~

不过在这些之前，还需要告诉你们debug怎么用~~mdzz作者连工具都不教的咯，打死~~



# 备忘附加小知识

**什么是栈？**

数据结构中，栈是一种一头封闭一头开放的结构，类似于一个试管，最早放入的元素会进入栈底，之后进入的则会在最顶上元素的上面，呈现出这样先进后出的特性。



-----------分割线------------



# 为什么鸽了【强行解释一波

前一段时间自觉看教学的课本知识量有限，而且思路不是特别顺畅，遂决定换本书来学习，恰巧想到王爽老师的书，堪称经典，便买来拜读，确实是一本思路清晰的好书。所以用更清晰的思路在这里讲也是很有必要的。

# 寻址？

**为了保证最高的学习效率，此处先上结论**

8086中，地址加法器采用**物理地址=段地址*16+偏移地址**的算法，物理地址可以理解成实际地址

举个例子，当你在debug里看到两个数字，中间以冒号链接时，首先要注意，**这两个数都是十六进制标识的**，他们的物理地址，就是第一个数字*16（十六进制表示就是10，十六进制中直接后面加个0即可）+第二个数字

例如你看到2304:0200的时候，它代表的物理地址就是23040H+200H=23240H（此处H代表16进制）

# CPU中寻址是为了干什么

讲一波道理，你不告诉CPU从哪里开始跑程序么！【汇编不是高级语言！和高级语言比有点“蠢”

# 关于CS和IP寄存器

CS寄存器和IP寄存器上一节我讲过了，~~这里能不讲么~~算了我们还是复习一遍

CS全称Code Segment，代码段寄存器，指出CPU要执行的代码存放的地方，IP是指令指针寄存器，相当于偏移地址

联系开头给出的公式，有这样一个结论

CPU执行CS*16+IP位置的指令

举个例子，CS存入了2000H，IP存入了0300H，那么CPU执行主存中20000H+300H=20300H位置的指令

简短的一记更新~~



未完待续...
